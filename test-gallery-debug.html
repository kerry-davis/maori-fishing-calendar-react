<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery Modal Test</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: 500;
        }
        .success { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }
        .error { background: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; }
        .info { background: #e0f2fe; color: #164e63; border: 1px solid #b3e5fc; }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Gallery Modal Test Suite</h1>
        <p>Test the fixed GalleryModal component to ensure images display correctly.</p>

        <div class="status info">
            <strong>Instructions:</strong><br>
            1. Click "Add Test Data" to create sample fish catches with photos<br>
            2. Click "Open Gallery Modal" to test the gallery<br>
            3. Verify that images display instead of gray placeholders<br>
            4. Use browser console to run debugGalleryImages() for detailed analysis
        </div>

        <button class="test-button" onclick="addTestData()">Add Test Data</button>
        <button class="test-button" onclick="openGalleryModal()">Open Gallery Modal</button>
        <button class="test-button" onclick="runDebugAnalysis()">Debug Analysis</button>
        <button class="test-button" onclick="clearTestData()">Clear Test Data</button>

        <div id="test-results" class="test-results" style="display: none;">
            <h3>Test Results</h3>
            <div id="results-content"></div>
        </div>
    </div>

    <script type="module">
        // Import the test scripts
        let testDataAdded = false;

        window.addTestData = async function() {
            try {
                showStatus('Adding test data...', 'info');

                // In a real app, this would be handled by the app's database service
                // For this test, we'll simulate the data
                const testImages = [
                    {
                        name: 'red-pixel',
                        data: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1" height="1"><rect width="1" height="1" fill="red"/></svg>',
                        species: 'Snapper',
                        length: '45',
                        weight: '2.5',
                        time: '14:30'
                    },
                    {
                        name: 'blue-pixel',
                        data: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1" height="1"><rect width="1" height="1" fill="blue"/></svg>',
                        species: 'Kahawai',
                        length: '35',
                        weight: '1.2',
                        time: '15:45'
                    }
                ];

                // Store in localStorage for this test
                localStorage.setItem('testGalleryImages', JSON.stringify(testImages));
                testDataAdded = true;

                showStatus(`‚úÖ Added ${testImages.length} test images successfully!`, 'success');
                showResults('Test Data Added', {
                    'Images Added': testImages.length,
                    'Species': testImages.map(img => img.species).join(', '),
                    'Storage': 'localStorage (testGalleryImages)'
                });

            } catch (error) {
                showStatus('‚ùå Failed to add test data: ' + error.message, 'error');
                console.error('Test data error:', error);
            }
        };

        window.openGalleryModal = function() {
            if (!testDataAdded) {
                showStatus('‚ö†Ô∏è Please add test data first!', 'info');
                return;
            }

            showStatus('Opening Gallery Modal...', 'info');

            // Create a simple modal overlay
            const modal = document.createElement('div');
            modal.id = 'test-gallery-modal';
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; padding: 20px; border-radius: 8px; max-width: 90%; max-height: 90%; overflow: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2>Gallery Modal Test</h2>
                            <button onclick="closeGalleryModal()" style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Close</button>
                        </div>
                        <div id="gallery-content">
                            <p>Loading test images...</p>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Simulate gallery content
            setTimeout(() => {
                const testImages = JSON.parse(localStorage.getItem('testGalleryImages') || '[]');
                const galleryContent = document.getElementById('gallery-content');

                if (testImages.length > 0) {
                    galleryContent.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                            ${testImages.map((img, index) => `
                                <div style="border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden;">
                                    <img src="${img.data}"
                                         alt="${img.species}"
                                         style="width: 100%; height: 200px; object-fit: cover;"
                                         onload="this.nextElementSibling.textContent = '‚úÖ Loaded: ${img.species}'"
                                         onerror="this.nextElementSibling.textContent = '‚ùå Failed: ${img.species}'; console.error('Image failed:', this.src)">
                                    <div style="padding: 12px; text-align: center; font-size: 14px;">
                                        Loading ${img.species}...
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: #f1f5f9; border-radius: 6px;">
                            <h3>Instructions:</h3>
                            <p>‚Ä¢ Images should display as colored squares (red, blue, etc.)</p>
                            <p>‚Ä¢ If you see gray placeholders instead, there's still an issue</p>
                            <p>‚Ä¢ Check browser console for detailed error messages</p>
                            <p>‚Ä¢ Use the "Debug Analysis" button for technical details</p>
                        </div>
                    `;
                } else {
                    galleryContent.innerHTML = '<p>No test images found. Please add test data first.</p>';
                }
            }, 500);
        };

        window.closeGalleryModal = function() {
            const modal = document.getElementById('test-gallery-modal');
            if (modal) {
                modal.remove();
            }
        };

        window.runDebugAnalysis = function() {
            showStatus('Running debug analysis...', 'info');

            const testImages = JSON.parse(localStorage.getItem('testGalleryImages') || '[]');
            const results = {
                'Test Images Count': testImages.length,
                'Image Data Status': [],
                'Console Commands': 'Run debugGalleryImages() in browser console when modal is open'
            };

            testImages.forEach((img, index) => {
                const isValidDataUrl = img.data.startsWith('data:image/');
                const hasValidBase64 = /^[A-Za-z0-9+/=]+$/.test(img.data.split(',')[1] || '');

                results['Image Data Status'].push({
                    [`Image ${index + 1} (${img.species})`]: {
                        'Valid Data URL': isValidDataUrl ? '‚úÖ' : '‚ùå',
                        'Valid Base64': hasValidBase64 ? '‚úÖ' : '‚ùå',
                        'Data Length': img.data.length
                    }
                });
            });

            showResults('Debug Analysis', results);
        };

        window.clearTestData = function() {
            localStorage.removeItem('testGalleryImages');
            testDataAdded = false;
            showStatus('üóëÔ∏è Test data cleared', 'info');
            document.getElementById('test-results').style.display = 'none';
        };

        function showStatus(message, type) {
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;

            // Remove existing status
            const existingStatus = document.querySelector('.status');
            if (existingStatus) {
                existingStatus.remove();
            }

            // Add new status
            const container = document.querySelector('.test-container');
            const buttonContainer = container.querySelector('.test-button').parentNode;
            container.insertBefore(statusDiv, buttonContainer);
        }

        function showResults(title, results) {
            const resultsDiv = document.getElementById('test-results');
            const content = document.getElementById('results-content');

            let html = `<h4>${title}</h4>`;

            if (Array.isArray(results)) {
                html += '<ul>';
                results.forEach(item => {
                    html += `<li>${item}</li>`;
                });
                html += '</ul>';
            } else {
                html += '<ul>';
                Object.entries(results).forEach(([key, value]) => {
                    html += `<li><strong>${key}:</strong> `;
                    if (typeof value === 'object') {
                        html += '<ul>';
                        value.forEach(item => {
                            if (typeof item === 'object') {
                                Object.entries(item).forEach(([k, v]) => {
                                    html += `<li>${k}: ${JSON.stringify(v)}</li>`;
                                });
                            } else {
                                html += `<li>${item}</li>`;
                            }
                        });
                        html += '</ul>';
                    } else {
                        html += value;
                    }
                    html += '</li>';
                });
                html += '</ul>';
            }

            content.innerHTML = html;
            resultsDiv.style.display = 'block';
        }

        // Load debug scripts
        const debugScript = document.createElement('script');
        debugScript.src = 'scripts/debug-gallery-images.js';
        document.head.appendChild(debugScript);

        console.log('üß™ Gallery Modal Test Suite loaded');
        console.log('Available functions: addTestData(), openGalleryModal(), runDebugAnalysis(), clearTestData()');
    </script>
</body>
</html>